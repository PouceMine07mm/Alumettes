---


################################################################################
# this Play serves the purpose of botstrapping nodes by installing
# python if it absent from the freshly spun node (see: ubuntu 18.04...)


- hosts:
    - all
  gather_facts: 'false'
  # install python if not present
  pre_tasks:


    - name: "test if python is installed"
      raw: which python
      register: which_python_result
      ignore_errors: 'true'
      changed_when: 'false'
      failed_when: 'false'


    - name: "test if apt is installed"
      raw: which apt
      register: which_apt_result
      ignore_errors: 'true'
      changed_when: 'false'
      failed_when: 'false'


    - name: "test if yum is installed"
      raw: which yum
      register: which_yum_result
      ignore_errors: 'true'
      changed_when: 'false'
      failed_when: 'false'


    - name: "run yum checkupdate"
      raw: yum check-update
      ignore_errors: 'true'
      changed_when: 'false'
      failed_when: 'false'
      when:
        - which_yum_result.rc == 0


    - name: "run apt -y update"
      raw: apt-get -y update
      ignore_errors: 'true'
      changed_when: 'false'
      failed_when: 'false'
      when:
        - which_apt_result.rc == 0


    - name: "install python (using YUM) if absent"
      raw: yum install -y "{{ item }}"
      loop:
        - python2
        - python3
      when:
        - which_python_result.rc != 0
        - which_yum_result.rc == 0


    - name: "install python (using APT) if absent"
      become: 'true'
      raw: ( apt-get install -y python-minimal )
      when:
        - which_python_result.rc != 0
        - which_apt_result.rc == 0


  tags:
    - common
    - install_python
